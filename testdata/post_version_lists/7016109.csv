Id;PostId;UserId;PostHistoryTypeId;RevisionGUID;CreationDate;Text;UserDisplayName;Comment
15386586;7016109;863791;2;404e434d-53da-4d7c-bbec-87856f066eac;2011-08-10 18:48:55.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??




    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>

    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return false;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />


    <script type=""text/javascript"">

        var selICol; //iCol of selected cell
        var selIRow; //iRow of selected cell

        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var RecordsInEditMode = assetGrid.find(""tr[editable='1'"");
                return (RecordsInEditMode && RecordsInEditMode.length > 0);
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {

                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            assetGrid.editCell(this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);
                            // transfer focus to the input
                            var inp = $(cell).children(""input,select,textarea"")
                            if (inp) {
                                $(inp[0]).val('');
                                inp.focus();
                            }
                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    cell.addClass(""sel"");
                    concat += cell.html() + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += ""\\n"";
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                datatype: function (pdata) {
                    getData(pdata);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Qty', 'Equip#', 'Year', 'Make', 'Model', 'Serial#', 'Class', 'IsLot', 'Cond', 'FLV', 'OLV', 'LVIP', 'FMV_R', 'FMV_E', 'FMV_I', 'FMV_ICU', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Quantity', label: 'Qty', width: 40, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'EquipmentNum', label: 'Equip#', width: 80, editable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'ManufacturedYear', label: 'Year', width: 70, editable: true, edittype: 'text', editoptions: { size: 18, editrules: { url: false }, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'SerialNum', label: 'Serial#', width: 105, editable: true, edittype: 'text', editoptions: { size: 18, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* Defines whether we want to display the number of total records from the query in the pager bar */
                pginput: false,
                sortorder: ""desc"",
                cellEdit: true,
                jsonReader: {
                    root: function (obj) {
                        return obj.SearchResultSet;
                    },
                    page: function (obj) { return 1; },
                    total: function (obj) { return 1; },
                    records: function (obj) {
                        return obj.ItemCount;
                    },
                    id: ""AssetID"",
                    repeatitems: false
                },
                loadonce: true,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    selICol = iCol;
                    selIRow = iRow;

                    // if the row should not be editable than simply turn the cells back to read only mode 
                    //assetGrid.editCell(iRow, iCol, false);
                    //assetGrid.restoreCell(iRow,iCol);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            assetGrid.editCell(fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            // transfer focus to the input
                                            var inp = $(this).children(""input,select,textarea"")
                                            if (inp) {
                                                $(inp[0]).val('');
                                                inp.focus();
                                            }
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        selectTo(this);
                                    }).mouseup(function () {
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            //$(""#grd_asset"").jqGrid('navGrid','#pfrmac',{edit:false,add:false,del:false});


            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                        if ($(""#hidModStartCell"").val() !== undefined && $(""#hidModStartCell"").val() != '' && $(""#hidModEndCell"").val() !== undefined && $(""#hidModEndCell"").val() != '') {
                            startcell = $(""#hidModStartCell"").val().split(',');
                            startrow = startcell[0] - 0;
                            startcol = startcell[1] - 0;

                            endcell = $(""#hidModEndCell"").val().split(',');
                            endrow = endcell[0] - 0;
                            endcol = endcell[1] - 0;

                            for (i = startrow; i <= endrow; i++) {
                                for (j = startcol; j <= endcol; j++) {
                                    assetGrid.restoreCell(i, j);
                                }
                            }
                        }
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });


        /********************************************************************/
        /*********** Method to retrieve Project Asset information ***********/
        /********************************************************************/
        function getData(pdata) {
            $.ajax({
                type: ""POST"",
                contentType: ""application/json; charset=utf-8"",
                url: '../api/Internalservices.asmx/GetProjectAssets',
                data: ""{ projectid: '"" + getQuerystring('projectid', '') + ""', page: '"" + pdata.page +
                        ""', pageSize: '"" + pdata.rows + ""', sortIndex: '"" + pdata.sidx +
                        ""', sortDirection: '"" + pdata.sord + ""'}"",
                dataType: ""json"",
                success: function (jsondata, stat) {
                    var thegrid = assetGrid[0];
                    if (jsondata.hasOwnProperty('d'))
                        jsondata = jsondata.d;

                    thegrid.addJSONData(jsondata);
                }
            });
        }


        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                datarows = info.split(""\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;
                    for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                        datarows[i] = datarows[i].split(""\\t"");
                        var row = null;
                        var rowId = null;
                        var rowindex = null;
                        for (j = 0; j < datarows[i].length && currentcell != null; ++j) {
                            // mark the row as altered
                            if (!currentcell.parent().hasClass(""altered""))
                                currentcell.parent().addClass(""altered"");
                            // for each outer iteration get the rowid
                            if (row == null) {
                                row = (currentcell).closest('tr.jqgrow');
                                rowId = row.attr('id');
                            }                            
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex(currentcell)].name, datarows[i][j], '', '', true);
                            prevcell = currentcell;
                            currentcell = currentcell.next();
                        }

                        currentrow = currentrow.next();
                        currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                    }                    
                }
            }

            if (prevcell != null)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>





Many Thanks in advance!

";;
15388755;7016109;863791;5;a5a0d493-c91c-42a4-afbe-89830f2c5ed8;2011-08-10 20:02:35.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??




    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>

    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return false;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />


    <script type=""text/javascript"">

        var selICol; //iCol of selected cell
        var selIRow; //iRow of selected cell

        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var RecordsInEditMode = assetGrid.find(""tr[editable='1'"");
                return (RecordsInEditMode && RecordsInEditMode.length > 0);
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {

                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            assetGrid.editCell(this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);
                            // transfer focus to the input
                            var inp = $(cell).children(""input,select,textarea"")
                            if (inp) {
                                $(inp[0]).val('');
                                inp.focus();
                            }
                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    cell.addClass(""sel"");
                    concat += cell.html() + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += ""\\n"";
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                datatype: function (pdata) {
                    getData(pdata);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Qty', 'Equip#', 'Year', 'Make', 'Model', 'Serial#', 'Class', 'IsLot', 'Cond', 'FLV', 'OLV', 'LVIP', 'FMV_R', 'FMV_E', 'FMV_I', 'FMV_ICU', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Quantity', label: 'Qty', width: 40, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'EquipmentNum', label: 'Equip#', width: 80, editable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'ManufacturedYear', label: 'Year', width: 70, editable: true, edittype: 'text', editoptions: { size: 18, editrules: { url: false }, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'SerialNum', label: 'Serial#', width: 105, editable: true, edittype: 'text', editoptions: { size: 18, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* Defines whether we want to display the number of total records from the query in the pager bar */
                pginput: false,
                sortorder: ""desc"",
                cellEdit: true,
                jsonReader: {
                    root: function (obj) {
                        return obj.SearchResultSet;
                    },
                    page: function (obj) { return 1; },
                    total: function (obj) { return 1; },
                    records: function (obj) {
                        return obj.ItemCount;
                    },
                    id: ""AssetID"",
                    repeatitems: false
                },
                loadonce: true,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    selICol = iCol;
                    selIRow = iRow;

                    // if the row should not be editable than simply turn the cells back to read only mode 
                    //assetGrid.editCell(iRow, iCol, false);
                    //assetGrid.restoreCell(iRow,iCol);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            assetGrid.editCell(fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            // transfer focus to the input
                                            var inp = $(this).children(""input,select,textarea"")
                                            if (inp) {
                                                $(inp[0]).val('');
                                                inp.focus();
                                            }
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        selectTo(this);
                                    }).mouseup(function () {
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            //$(""#grd_asset"").jqGrid('navGrid','#pfrmac',{edit:false,add:false,del:false});


            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                        if ($(""#hidModStartCell"").val() !== undefined && $(""#hidModStartCell"").val() != '' && $(""#hidModEndCell"").val() !== undefined && $(""#hidModEndCell"").val() != '') {
                            startcell = $(""#hidModStartCell"").val().split(',');
                            startrow = startcell[0] - 0;
                            startcol = startcell[1] - 0;

                            endcell = $(""#hidModEndCell"").val().split(',');
                            endrow = endcell[0] - 0;
                            endcol = endcell[1] - 0;

                            for (i = startrow; i <= endrow; i++) {
                                for (j = startcol; j <= endcol; j++) {
                                    assetGrid.restoreCell(i, j);
                                }
                            }
                        }
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });


        /********************************************************************/
        /*********** Method to retrieve Project Asset information ***********/
        /********************************************************************/
        function getData(pdata) {
            $.ajax({
                type: ""POST"",
                contentType: ""application/json; charset=utf-8"",
                url: '../api/Internalservices.asmx/GetProjectAssets',
                data: ""{ projectid: '"" + getQuerystring('projectid', '') + ""', page: '"" + pdata.page +
                        ""', pageSize: '"" + pdata.rows + ""', sortIndex: '"" + pdata.sidx +
                        ""', sortDirection: '"" + pdata.sord + ""'}"",
                dataType: ""json"",
                success: function (jsondata, stat) {
                    var thegrid = assetGrid[0];
                    if (jsondata.hasOwnProperty('d'))
                        jsondata = jsondata.d;

                    thegrid.addJSONData(jsondata);
                }
            });
        }


        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                datarows = info.split(""\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;
                    for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                        if (datarows[i] == '') break;
                        datarows[i] = datarows[i].split(""\\t"");
                        var row = null;
                        var rowId = null;
                        var rowindex = null;
                        for (j = 0; j < datarows[i].length && currentcell != null; ++j) {
                            // mark the row as altered
                            if (!currentcell.parent().hasClass(""altered""))
                                currentcell.parent().addClass(""altered"");
                            // for each outer iteration get the rowid
                            if (row == null) {
                                row = (currentcell).closest('tr.jqgrow');
                                rowId = row.attr('id');
                            }                            
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex(currentcell)].name, datarows[i][j], '', '', true);
                            prevcell = currentcell;
                            currentcell = currentcell.next();
                        }

                        currentrow = currentrow.next();
                        currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                    }                    
                }
            }

            if (prevcell != null)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>





Many Thanks in advance!

";;added 55 characters in body
15391982;7016109;863791;5;82ba2f85-d0f7-4ffe-9dcf-3e479f01e37a;2011-08-10 21:58:00.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??




    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>

    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return false;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />


    <script type=""text/javascript"">

        var selICol; //iCol of selected cell
        var selIRow; //iRow of selected cell

        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var RecordsInEditMode = assetGrid.find(""tr[editable='1'"");
                return (RecordsInEditMode && RecordsInEditMode.length > 0);
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {

                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            assetGrid.editCell(this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);
                            // transfer focus to the input
                            var inp = $(cell).children(""input,select,textarea"")
                            if (inp) {
                                $(inp[0]).val('');
                                inp.focus();
                            }
                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    cell.addClass(""sel"");
                    concat += cell.html() + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += ""\\n"";
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                datatype: function (pdata) {
                    getData(pdata);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Qty', 'Equip#', 'Year', 'Make', 'Model', 'Serial#', 'Class', 'IsLot', 'Cond', 'FLV', 'OLV', 'LVIP', 'FMV_R', 'FMV_E', 'FMV_I', 'FMV_ICU', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Quantity', label: 'Qty', width: 40, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'EquipmentNum', label: 'Equip#', width: 80, editable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'ManufacturedYear', label: 'Year', width: 70, editable: true, edittype: 'text', editoptions: { size: 18, editrules: { url: false }, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'SerialNum', label: 'Serial#', width: 105, editable: true, edittype: 'text', editoptions: { size: 18, dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* Defines whether we want to display the number of total records from the query in the pager bar */
                pginput: false,
                sortorder: ""desc"",
                cellEdit: true,
                jsonReader: {
                    root: function (obj) {
                        return obj.SearchResultSet;
                    },
                    page: function (obj) { return 1; },
                    total: function (obj) { return 1; },
                    records: function (obj) {
                        return obj.ItemCount;
                    },
                    id: ""AssetID"",
                    repeatitems: false
                },
                loadonce: true,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    selICol = iCol;
                    selIRow = iRow;

                    // if the row should not be editable than simply turn the cells back to read only mode 
                    //assetGrid.editCell(iRow, iCol, false);
                    //assetGrid.restoreCell(iRow,iCol);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            assetGrid.editCell(fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            // transfer focus to the input
                                            var inp = $(this).children(""input,select,textarea"")
                                            if (inp) {
                                                $(inp[0]).val('');
                                                inp.focus();
                                            }
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        selectTo(this);
                                    }).mouseup(function () {
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            //$(""#grd_asset"").jqGrid('navGrid','#pfrmac',{edit:false,add:false,del:false});


            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                        if ($(""#hidModStartCell"").val() !== undefined && $(""#hidModStartCell"").val() != '' && $(""#hidModEndCell"").val() !== undefined && $(""#hidModEndCell"").val() != '') {
                            startcell = $(""#hidModStartCell"").val().split(',');
                            startrow = startcell[0] - 0;
                            startcol = startcell[1] - 0;

                            endcell = $(""#hidModEndCell"").val().split(',');
                            endrow = endcell[0] - 0;
                            endcol = endcell[1] - 0;

                            for (i = startrow; i <= endrow; i++) {
                                for (j = startcol; j <= endcol; j++) {
                                    assetGrid.restoreCell(i, j);
                                }
                            }
                        }
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });


        /********************************************************************/
        /*********** Method to retrieve Project Asset information ***********/
        /********************************************************************/
        function getData(pdata) {
            $.ajax({
                type: ""POST"",
                contentType: ""application/json; charset=utf-8"",
                url: '../api/Internalservices.asmx/GetProjectAssets',
                data: ""{ projectid: '"" + getQuerystring('projectid', '') + ""', page: '"" + pdata.page +
                        ""', pageSize: '"" + pdata.rows + ""', sortIndex: '"" + pdata.sidx +
                        ""', sortDirection: '"" + pdata.sord + ""'}"",
                dataType: ""json"",
                success: function (jsondata, stat) {
                    var thegrid = assetGrid[0];
                    if (jsondata.hasOwnProperty('d'))
                        jsondata = jsondata.d;

                    thegrid.addJSONData(jsondata);
                }
            });
        }


        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                datarows = info.split(""\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;
                    for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                        if (datarows[i] == '') break;
                        datarows[i] = datarows[i].split(""\\t"");
                        var row = null;
                        var rowId = null;
                        var rowindex = null;
                        for (j = 0; j < datarows[i].length && currentcell != null; ++j) {
                            // mark the row as altered
                            if (!currentcell.parent().hasClass(""altered""))
                                currentcell.parent().addClass(""altered"");
                            // for each outer iteration get the rowid
                            if (row == null) {
                                row = (currentcell).closest('tr.jqgrow');
                                rowId = row.attr('id');
                            }                            
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex(currentcell)].name, datarows[i][j], '', '', true);
                            prevcell = currentcell;
                            currentcell = currentcell.next();
                        }

                        currentrow = currentrow.next();
                        currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                    }                    
                }
            }

            if (prevcell != null)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>





Many Thanks in advance!

";;added 83 characters in body
16341926;7016109;863791;5;74d1359d-2747-4762-83c1-1ace204030d4;2011-09-13 17:13:53.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??




    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>

    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return false;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />


    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var RecordsInEditMode = assetGrid.find(""tr[editable='1'"");
                return (RecordsInEditMode && RecordsInEditMode.length > 0);
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {

                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            assetGrid.editCell(this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);
                            // transfer focus to the input
                            var inp = $(cell).children(""input,select,textarea"")
                            if (inp) inp.focus();
                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/Internalservices.asmx/GetProjectAssets',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        selectTo(this);
                                    }).mouseup(function () {
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
/*** TBD : Undo feature requires more coding than I thought. No jqgrid features available to get the help  ***/
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>





Many Thanks in advance!

";;deleted 97 characters in body
16342585;7016109;863791;5;937f7278-4b62-4452-b37b-f56210a3ddca;2011-09-13 17:36:08.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??

    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>

    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return false;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />


    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var RecordsInEditMode = assetGrid.find(""tr[editable='1'"");
                return (RecordsInEditMode && RecordsInEditMode.length > 0);
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {

                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            assetGrid.editCell(this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);
                            // transfer focus to the input
                            var inp = $(cell).children(""input,select,textarea"")
                            if (inp) inp.focus();
                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/yourservices.asmx/GetData',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        selectTo(this);
                                    }).mouseup(function () {
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                    // TBD : No jqgrid features available to get the help 
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>

Many Thanks in advance!

Edited on 9/13:
This is my first use of JQGrid. I'm using ver 4.1.2. I spent few weeks to put together the excel like grid and the biggest challenge was to find the right information on how to use JQGrid. My current setup has lots of ajax updates and image galleries and use of jqgrid formatter but what I've put here is the main code to be able to use JQgrid with server side paging, excel like copy-paste and demonstration of few other features on jqgrid. This is just my way of giving back for all the help that I got from this community. 

For people who just jumped to JQGrid, you will soon find out that there is some challenge to using Textarea in jqgrid. you can find some solutions [here](http://www.trirand.com/blog/?page_id=393/bugs/celledit-textarea-newline-enter-will-close-cell/&value=5216&type=8&include=0&search=1&ret=all).";;deleted 97 characters in body
18888405;7016109;863791;5;120f22cc-eca8-4801-85fe-ca9a28470218;2011-12-08 00:44:53.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??

    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>
    <script type=""text/javascript"">
        var enableOnSelectEvent = false; // handle text selection
    </script>
    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return enableOnSelectEvent;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />

    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var savedRows = assetGrid.getGridParam('savedRow');
                return (savedRows && savedRows.length > 0);
            }
            this.PutCellInEdit = function (cell, irow, icol, edit) {
                assetGrid.editCell(irow, icol, edit);
                // transfer focus to the input
                var inp = $(cell).children(""input"")
                if (inp && inp.length > 0) {
                    $(inp[0]).val('');
                    $(inp[0]).focus();
                }
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {
                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            this.PutCellInEdit(cell, this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/yourservices.asmx/GetData',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = true;
                },
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                afterSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                afterRestoreCell: function (rowid, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                    }).mouseup(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        if (fnassetgrid.IsInEditMode()) return true;
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                    // TBD : No jqgrid features available to get the help 
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>

Many Thanks in advance!

Edited on 9/13:
This is my first use of JQGrid. I'm using ver 4.1.2. I spent few weeks to put together the excel like grid and the biggest challenge was to find the right information on how to use JQGrid. My current setup has lots of ajax updates and image galleries and use of jqgrid formatter but what I've put here is the main code to be able to use JQgrid with server side paging, excel like copy-paste and demonstration of few other features on jqgrid. This is just my way of giving back for all the help that I got from this community. 

For people who just jumped to JQGrid, you will soon find out that there is some challenge to using Textarea in jqgrid. you can find some solutions [here](http://www.trirand.com/blog/?page_id=393/bugs/celledit-textarea-newline-enter-will-close-cell/&value=5216&type=8&include=0&search=1&ret=all).";;added 987 characters in body
24408861;7016109;863791;5;c1549155-dbde-4de5-8bfd-4950a6a01903;2012-05-14 22:58:45.0;"Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??

    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>
    <script type=""text/javascript"">
        var enableOnSelectEvent = false; // handle text selection
    </script>
    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return enableOnSelectEvent;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />

    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var savedRows = assetGrid.getGridParam('savedRow');
                return (savedRows && savedRows.length > 0);
            }
            this.PutCellInEdit = function (cell, irow, icol, edit) {
                assetGrid.editCell(irow, icol, edit);
                // transfer focus to the input
                var inp = $(cell).children(""input"")
                if (inp && inp.length > 0) {
                    $(inp[0]).val('');
                    $(inp[0]).focus();
                }
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {
                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            this.PutCellInEdit(cell, this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/yourservices.asmx/GetData',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = true;
                },
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                afterSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                afterRestoreCell: function (rowid, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                    }).mouseup(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        if (fnassetgrid.IsInEditMode()) return true;
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                    // TBD : No jqgrid features available to get the help 
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>

Many Thanks in advance!

Edited on 9/13/11:
This is my first use of JQGrid. I'm using ver 4.1.2. I spent few weeks to put together the excel like grid and the biggest challenge was to find the right information on how to use JQGrid. My current setup has lots of ajax updates and image galleries and use of jqgrid formatter but what I've put here is the main code to be able to use JQgrid with server side paging, excel like copy-paste and demonstration of few other features on jqgrid. This is just my way of giving back for all the help that I got from this community. 

For people who just jumped to JQGrid, you will soon find out that there is some challenge to using Textarea in jqgrid. you can find some solutions [here](http://www.trirand.com/blog/?page_id=393/bugs/celledit-textarea-newline-enter-will-close-cell/&value=5216&type=8&include=0&search=1&ret=all).

Edited on 5/14/12:
i was finally able to jump out of my laziness and prepare this to share the actual [EXCEL LIKE JQGRID implementation](http://jsfiddle.net/justcurious/qLQRA/). The cell selection may work weird on jsfiddle on few browsers but it should work normal on your development box. Have fun!!!!";;added 305 characters in body
24440731;7016109;863791;5;6c371e44-e89a-4a27-8b31-064621ae922d;2012-05-15 16:12:46.0;"**Edited on 5/14/12:**
i was finally able to jump out of my laziness and prepare this to share the actual [EXCEL LIKE JQGRID implementation](http://jsfiddle.net/justcurious/qLQRA/). The cell selection may work weird on jsfiddle on few browsers but it should work normal on your development box. Have fun!!!!

**Edited on 9/13/11:**
This is my first use of JQGrid. I'm using ver 4.1.2. I spent few weeks to put together the excel like grid and the biggest challenge was to find the right information on how to use JQGrid. My current setup has lots of ajax updates and image galleries and use of jqgrid formatter but what I've put here is the main code to be able to use JQgrid with server side paging, excel like copy-paste and demonstration of few other features on jqgrid. This is just my way of giving back for all the help that I got from this community. 

For people who just jumped to JQGrid, you will soon find out that there is some challenge to using Textarea in jqgrid. you can find some solutions [here](http://www.trirand.com/blog/?page_id=393/bugs/celledit-textarea-newline-enter-will-close-cell/&value=5216&type=8&include=0&search=1&ret=all).

**Original post:**  
Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here http://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??

    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>
    <script type=""text/javascript"">
        var enableOnSelectEvent = false; // handle text selection
    </script>
    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return enableOnSelectEvent;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />

    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var savedRows = assetGrid.getGridParam('savedRow');
                return (savedRows && savedRows.length > 0);
            }
            this.PutCellInEdit = function (cell, irow, icol, edit) {
                assetGrid.editCell(irow, icol, edit);
                // transfer focus to the input
                var inp = $(cell).children(""input"")
                if (inp && inp.length > 0) {
                    $(inp[0]).val('');
                    $(inp[0]).focus();
                }
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {
                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            this.PutCellInEdit(cell, this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/yourservices.asmx/GetData',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = true;
                },
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                afterSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                afterRestoreCell: function (rowid, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                    }).mouseup(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        if (fnassetgrid.IsInEditMode()) return true;
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                    // TBD : No jqgrid features available to get the help 
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>

Many Thanks in advance!";;added 30 characters in body
147110559;7016109;-1;5;c8d8760e-4ef9-4b86-9d65-c0149056eca3;2017-05-23 12:11:57.0;"**Edited on 5/14/12:**
i was finally able to jump out of my laziness and prepare this to share the actual [EXCEL LIKE JQGRID implementation](http://jsfiddle.net/justcurious/qLQRA/). The cell selection may work weird on jsfiddle on few browsers but it should work normal on your development box. Have fun!!!!

**Edited on 9/13/11:**
This is my first use of JQGrid. I'm using ver 4.1.2. I spent few weeks to put together the excel like grid and the biggest challenge was to find the right information on how to use JQGrid. My current setup has lots of ajax updates and image galleries and use of jqgrid formatter but what I've put here is the main code to be able to use JQgrid with server side paging, excel like copy-paste and demonstration of few other features on jqgrid. This is just my way of giving back for all the help that I got from this community. 

For people who just jumped to JQGrid, you will soon find out that there is some challenge to using Textarea in jqgrid. you can find some solutions [here](http://www.trirand.com/blog/?page_id=393/bugs/celledit-textarea-newline-enter-will-close-cell/&value=5216&type=8&include=0&search=1&ret=all).

**Original post:**  
Just to give little update before putting my question....

I've been able to come up with some additional features on the jqgrid that I'm using (after going through many forums) including: copy-paste back and forth from Excel to jqgrid, edit cell on keypress and dblclick, copy and paste multiple cells from one block to another on the same grid using mouse selection (from here https://stackoverflow.com/questions/1821074/using-javascript-to-sum-selected-cells-in-ie6)

Most of the copy paste features works on IE only as of now. I save all the changes together on ""Save"" button click so all the updates on the cells are on screen only until user hits the ""Save"" button.

Although, things are still in flux right now, I'd like to have the implementation design on paper now than later. I'm looking for an easy way to UNDO only the LAST change. I've been thinking of using jQuery's ""data()"" and ""removeData()"" methods to implement this but if there is anything already existing in jqgrid framework that would help, I would like to know. Any suggestions??

    <style type=""text/css"">
        .sel {background-color: #96B9DC !important; }
        .altered {}
    </style>
    <script type=""text/javascript"">
        var enableOnSelectEvent = false; // handle text selection
    </script>
    <div style=""width:100%; background-color:#FFF; border:1px solid #000;""><input id=""btnsavechanges"" value=""Save Changes"" style=""width:120px;"" class=""formbutton ui-corner-all"" type=""button"" onclick=""getChanges(); return false;"" /></div>
    <table id=""grd_asset"" width=""100%"" onSelectStart=""return enableOnSelectEvent;""></table>
    <div id=""pfrmac"" style='width:100%;'></div>
    <input type=""hidden"" id=""hidSelected"" value="""" />

    <!-- copy content from the grid cells -->
    <input type=""hidden"" id=""hidCopiedText"" value="""" />

    <!-- Start and End of cell selection -->
    <input type=""hidden"" id=""hidStartCell"" value="""" />
    <input type=""hidden"" id=""hidEndCell"" value="""" />

    <!-- Start and End of last modified cell(s) -->
    <input type=""hidden"" id=""hidModStartCell"" value="""" />
    <input type=""hidden"" id=""hidModEndCell"" value="""" />

    <script type=""text/javascript"">
        /*************************************************/
        /**************** Grid Utilities  ****************/
        /*************************************************/
        FnGrid = function () {
            this.GridColumns = function () {
                return assetGrid.jqGrid('getGridParam', 'colModel');
            }
            this.GetSelCells = function () {
                return assetGrid.find(""td.sel"");
            }
            this.ClearSelection = function () {
                assetGrid.find(""td"").removeClass(""sel"");
            }
            this.ClearSavedHistory = function () {
                assetGrid.removeData();
            }
            this.ClearMarkedChanges = function () {
                assetGrid.find(""tr"").removeClass(""altered"");
            }
            this.GetRowCells = function (cell) {
                return cell.parent().children(""td"")
            }
            this.GetRowId = function (cell) {
                var row = cell.closest('tr.jqgrow');
                return row.attr('id');
            }
            this.GetRowIndex = function (cell) {
                var cellrow = cell.parent();
                return cellrow.parent().children(""tr"").index(cellrow);
            }
            this.GetColIndex = function (cell) {
                return cell.parent().children(""td"").index(cell);
            }
            this.IsInEditMode = function () {
                var savedRows = assetGrid.getGridParam('savedRow');
                return (savedRows && savedRows.length > 0);
            }
            this.PutCellInEdit = function (cell, irow, icol, edit) {
                assetGrid.editCell(irow, icol, edit);
                // transfer focus to the input
                var inp = $(cell).children(""input"")
                if (inp && inp.length > 0) {
                    $(inp[0]).val('');
                    $(inp[0]).focus();
                }
            }
            this.HandleEditMode = function (cell, e) {
                var ctrl = e.ctrlKey;
                var alt = e.altKey;

                var keyCode = (e.keyCode ? e.keyCode : e.which);
                if (keyCode) {
                    if (keyCode >= 32 && keyCode <= 126 && !ctrl && !alt) {
                        // switch the cell to edit mode if not already
                        if (!($(cell).hasClass(""edit-cell""))) {
                            this.PutCellInEdit(cell, this.GetRowIndex($(cell)), this.GetColIndex($(cell)), true);                        }
                    }
                }
                return true;
            }
            this.HandleInputNavigation = function (ele, evt) {
                evt = window.event || evt;

                switch (evt.keyCode) {
                    // down arrow                   
                    case 40:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        downele = $(ele).parent()
                                .parent()
                                .next()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(downele)), this.GetColIndex($(downele)), true);
                        break;

                    // up arrow                   
                    case 38:
                        if (!$(ele).parent().hasClass(""altered""))
                            $(ele).parent().addClass(""altered"");

                        irow = this.GetRowIndex($(ele).parent());
                        icol = this.GetColIndex($(ele).parent())
                        var prevcell = irow + "","" + icol;
                        $(""#hidModStartCell"").val(prevcell);
                        $(""#hidModEndCell"").val(prevcell);

                        topele = $(ele).parent()
                                .parent()
                                .prev()
                                .children(""td"")[this.GetColIndex($(ele).parent())];

                        if (this.GetRowIndex($(topele)) <= 0) break;

                        this.ClearSelection();
                        assetGrid.editCell(this.GetRowIndex($(topele)), this.GetColIndex($(topele)), true);
                        break;
                }
            }
        }

        var autocomp = new AutoCompleteRequest();
        var lastSel = """";
        var assetGrid = $('#grd_asset');
        var start = null;
        var fnassetgrid = new FnGrid();
        var lastSel = -1;

        function selectTo(cell) {
            if (start == null)
                return;
            fnassetgrid.ClearSelection();
            var stop = $(cell);
            var tbl = start.closest(""table"");
            var rs = tbl.children(""tbody"").children(""tr"");
            var r0 = rs.index(start.parent()), c0 = fnassetgrid.GetColIndex(start);
            var r1 = rs.index(stop.parent()), c1 = fnassetgrid.GetColIndex(stop);
            var concat = """";
            for (var i = r0; i <= r1; i++) {
                var cells = $(rs.get(i)).children(""td"");
                var rowid = 0;
                for (var j = c0; j <= c1; j++) {
                    var cell = $(cells.get(j));
                    if (rowid == 0) rowid = fnassetgrid.GetRowId(cell);
                    if (cell.is("":hidden"")) continue;
                    cell.addClass(""sel"");
                    concat += assetGrid.getCell(rowid, j) + ""\\t"";
                }
                if (concat.lastIndexOf(""\\t"") == concat.length - 1)
                    concat = concat.substring(0, concat.lastIndexOf(""\\t""));

                concat += escape(""\\r\\n"");
            }
            $(""#hidSelected"").val(concat.trim());
        }


        $(document).ready(function () {
            /*************************************************/
            /******************* THE GRID  *******************/
            /*************************************************/
            assetGrid.jqGrid({
                ajaxGridOptions: { contentType: ""application/json; charset=utf-8"", type: ""POST"" },
                url: '../api/yourservices.asmx/GetData',
                datatype: 'json',
                serializeGridData: function (postData) {
                    if (postData.searchField === undefined) postData.searchField = null;
                    if (postData.searchString === undefined) postData.searchString = null;
                    if (postData.searchOper === undefined) postData.searchOper = null;
                    if (postData.filters === undefined) postData.filters = null;
                    return JSON.stringify(postData);
                },
                colNames: [' ', 'AssetId', 'Item#', 'Make', 'Description'],
                colModel: [
                    { name: 'ctrls', width: 80, fixed: true, sortable: false, resize: false, formatter: 'actions',
                        formatoptions: { keys: true }
                    },
   		            { name: 'AssetID', label: 'AssetID', width: 65, key: true, hidden: true },
   		            { name: 'Sequence', label: 'Item#', width: 50, align: ""right"", sorttype: 'int', sortable: true, editoptions: { dataEvents: [{ type: 'keydown', fn: function (e) { fnassetgrid.HandleInputNavigation(this, e); } }]} },
   		            { name: 'Make', label: 'Make', width: 105, editable: true, edittype: 'text', editoptions: {
   		                size: 18,
   		                dataEvents: [{
   		                    type: 'focus',
   		                    fn: function (e) {
   		                        $(this).autocomplete({
   		                            source: autocomp.source,
   		                            delay: autocomp.delay,
   		                            minLength: autocomp.minLength
   		                        });

   		                        $(this).bind(""autocompleteopen"", autocomp.open);
   		                        $(this).bind(""autocompleteclose"", autocomp.close);
   		                    }
   		                }]
   		            }
   		            },
                    { name: 'Description', label: 'Description', fixed: false, editable: true, edittype: 'textarea', unformat: unfrmttextarea, editoptions: { rows: ""10"", cols: ""40""} }
   	            ],
                rowNum: 10, /* no of recs in a grid */
                width: 1330,
                rowList: [10, 20, 30], /* array to construct a select box element in the pager */
                pager: '#pfrmac',
                sortname: 'AssetID', /* initial sorting column */
                viewrecords: true,  /* display the number of total records on the pager bar */
                pginput: true,
                sortorder: ""desc"",
                cellEdit: true,
                shrinkToFit: true,
                jsonReader: {
                    root: function (obj) { return obj.d.SearchResultSet; },
                    page: function (obj) { return obj.d.PageNum; }, // current page of the query
                    total: function (obj) { return obj.d.TotalPages; }, // total pages for the query
                    records: function (obj) { return obj.d.TotalNoOfSearchResultItems; },
                    id: ""AssetID"",
                    repeatitems: false,
                    userdata: function (obj) {
                        extendUserSession();
                        return { ""Error"": obj.d.Error, ""SearchResultSet"": obj.d.SearchResultSet }
                    }
                },
                loadonce: false,
                caption: ""Asset list"",
                height: '100%',
                cellsubmit: 'clientArray',
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = true;
                },
                beforeSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    savedrow = assetGrid.getGridParam('savedRow');
                    if (savedrow && savedrow.length > 0) {
                        if (savedrow[0].id == iRow && savedrow[0].ic == iCol && savedrow[0].v != value) {
                            tr = $('#' + rowid);
                            if (tr && !tr.hasClass(""altered"")) {
                                tr.addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                        }
                    }
                },
                afterSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                afterRestoreCell: function (rowid, value, iRow, iCol) {
                    enableOnSelectEvent = false;
                },
                loadComplete: function (data) {
                    if (assetGrid.getGridParam('userData').Error && assetGrid.getGridParam('userData').Error != '')
                        alert(""Error: "" + assetGrid.getGridParam('userData').Error);
                },
                gridComplete: function () {
                    rowindex = 1;
                    rows = assetGrid.find(""tr"");

                    if (rows && rows.length > 1) {
                        for (i = 1; i < rows.length; i++) {
                            $(rows[i]).find(""td"").each(function (evt) {
                                evt = window.event || evt;

                                start = $(this);
                                colindex = fnassetgrid.GetColIndex(start);
                                if (colindex > 0) {
                                    $(this).click(function () {
                                        if (!($(this).hasClass(""edit-cell"")))
                                            return false;
                                    }).dblclick(function () {
                                        if (!($(this).hasClass(""edit-cell""))) {
                                            fnassetgrid.PutCellInEdit(this, fnassetgrid.GetRowIndex($(this)), fnassetgrid.GetColIndex($(this)), true);
                                            return;
                                        }
                                        else
                                            return true;
                                    }).mousedown(function () {
                                        if (fnassetgrid.IsInEditMode())
                                            return true;
                                        start = $(this);
                                        selectTo(this);
                                        return false;
                                    }).mouseover(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                    }).mouseup(function () {
                                        if (fnassetgrid.IsInEditMode()) return true;
                                        selectTo(this);
                                        $(""#hidEndCell"").val(fnassetgrid.GetColIndex($(this)));
                                        start = null;
                                    }).keypress(function (e) {
                                        fnassetgrid.HandleEditMode(this, e);
                                    });
                                }
                            });
                            rowindex++;
                        }
                    }
                }
            });

            function unfrmttextarea(cellvalue, options, cellobject) {
                return cellvalue;
            }

            $(""body"").mouseup(function () {
                start = null;
            });


            /*************************************************/
            /*********** Global KEYUP integration  ***********/
            /*************************************************/
            $(assetGrid).keyup(function (e) {
                var ctrl = e.ctrlKey
                var key = e.charCode || e.keyCode || 0;

                if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */ || (ctrl && key == 86) /* PASTE */ || (ctrl && key == 90) /* UNDO */) {

                    if ((ctrl && key == 88) /* CUT */ || (ctrl && key == 67) /* COPY */) {
                        if (fnassetgrid.IsInEditMode()) return true;
                        CopyToClipboard(""hidSelected"");

                        var selectedCells = fnassetgrid.GetSelCells();

                        if (selectedCells && selectedCells.length > 0) {
                            $(""#hidStartCell"").val(fnassetgrid.GetRowIndex($(selectedCells[0])) + "","" + fnassetgrid.GetColIndex($(selectedCells[0])));
                            $(""#hidEndCell"").val(fnassetgrid.GetRowIndex($(selectedCells[selectedCells.length - 1])) + "","" + fnassetgrid.GetColIndex($(selectedCells[selectedCells.length - 1])));
                            $(""#hidCopiedText"").val($(""#hidSelected"").val());
                        }
                        else {
                            $(""#hidStartCell"").val('');
                            $(""#hidEndCell"").val('');
                        }

                        if (ctrl && key == 88) /* CUT */{
                            assetGrid.find(""td.sel"").each(function () {
                                row = $(this).closest('tr.jqgrow');
                                rowId = row.attr('id');
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[fnassetgrid.GetColIndex($(this))].name, '', '', '', true);
                            });
                            fnassetgrid.ClearSelection();
                        }
                    }
                    else if (ctrl && key == 86) /* PASTE */{
                        var clipboardata = getClipboardData();
                        if (get_objtype(clipboardata) != ""[object String]"") {
                            alert(""The data you are pasting either is empty or incompatible"");
                            return false;
                        }

                        pasteinfo(assetGrid, clipboardata);
                    }
                    else if ((ctrl && key == 90) /* UNDO */) {
                    // TBD : No jqgrid features available to get the help 
                    }
                    return false; // prevent bubbling
                }
                else
                    return true; // let it bubble
            });
        });

        
        /********************************************************************/
        /*********** Method to retrieve and submit altered asset information ***********/
        /********************************************************************/
        function getChanges() {
            var editedxml = ""<?xml version='1.0' encoding='utf-8' ?\\>\\n"";
            editedxml += ""<ASSETS>\\n"";
            assetGrid.find(""tr.altered"").each(function () {
                editedxml += ""<ASSET>\\n"";
                $(this).children(""td"").each(function () {
                    colindex = fnassetgrid.GetColIndex($(this));                    
                    if (colindex > 0) {
                        editedxml += ""<"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">"" + $(this).text().trim() + ""</"" + (fnassetgrid.GridColumns())[colindex].name.toUpperCase() + "">\\n"";
                    }
                })
                editedxml += ""</ASSET>\\n"";
            })
            editedxml += ""</ASSETS>"";

            fnassetgrid.ClearMarkedChanges();
            
            //TBD: submit XML to an AJAX service
        }


        var _browserPasteData = null;
        function getClipboardData() {
            if (_browserPasteData) // Safari/Chrome logic
                return _browserPasteData;
            if (window.clipboardData) // IE logic
            {
                return window.clipboardData.getData(""Text"");
            }
            else if (typeof (netscape) != ""undefined"") // Firefox logic
            {
                netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
                var clip = Components.classes[""@mozilla.org/widget/clipboard;1""].createInstance(Components.interfaces.nsIClipboard);
                var trans = Components.classes[""@mozilla.org/widget/transferable;1""].createInstance(Components.interfaces.nsITransferable);
                trans.addDataFlavor(""text/unicode"");
                clip.getData(trans, clip.kGlobalClipboard);
                var str = new Object();
                var len = new Object();
                trans.getTransferData(""text/unicode"", str, len);
                if (str)
                    return str.value.QueryInterface(Components.interfaces.nsISupportsString).toString();
            }
            return null;
        }
        // In Safari/Chrome the clipboard data can only be accessed
        // from the onpaste event. In this sample the event is handled 
        // off the body element: <body onpaste=""browserPaste(event)"">
        function browserPaste(e) {
            _browserPasteData = e.clipboardData && e.clipboardData.getData ?
                e.clipboardData.getData('text/plain') : null;
        }

        function pasteinfo(objGrid, info) {
            selectedCells = fnassetgrid.GetSelCells();
            firstcell = $(selectedCells[0]);
            firstselectedcolindex = fnassetgrid.GetColIndex(firstcell);
            rowcellscount = fnassetgrid.GetRowCells(firstcell).length;

            if (firstselectedcolindex == 0) {
                alert(""You cannot paste into an non-editable column"");
                return false;
            }

            if (selectedCells && selectedCells.length > 0) {
                // if the clipboard info is from the asset grid
                if (info && info == $(""#hidCopiedText"").val()) {
                    // get the index values of last copied source cell
                    hidStartCell = -1;
                    if ($(""#hidStartCell"").val() != '' && $(""#hidStartCell"").val().split(',').length > 1) {
                        hidStartCell = $(""#hidStartCell"").val().split(',')[1];
                    }

                    // if columns of source and dest do not match, throw warning
                    if (firstselectedcolindex != hidStartCell) {
                        if (!confirm(""The data you are pasting comes from a different set of \\ncolumns than those that you are pasting into.\\n\\nAre you sure you want to paste into these columns?""))
                            return false;
                    }
                }

                $(""#hidModStartCell"").val(fnassetgrid.GetRowIndex(firstcell) + "","" + firstselectedcolindex);

                var prevcell = null;
                // remove the last ""line break"" and break clipboard info into lines
                datarows = unescape(info).replace(/\\r\\n$/, '').split(""\\r\\n"");
                if (datarows && datarows.length > 0) {
                    currentrow = firstcell.parent();
                    currentcell = firstcell;

                    // if the source is a single cell, allow it to be pasted over multiple cells
                    if (datarows.length == 1 && datarows[0].split(""\\t"").length == 1) {
                        copydata = datarows[0].split(""\\t"");

                        $.each(selectedCells, function (index, value) {
                            prevcell = $(value);
                            if (!prevcell.parent().hasClass(""altered"")) {
                                prevcell.parent().addClass(""altered"");
                                there_are_unsaved_changes = 1;
                            }
                            var rowId = prevcell.closest('tr.jqgrow').attr('id');
                            var icol = fnassetgrid.GetColIndex(prevcell);
                            assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, copydata[0], '', '', true);
                        });
                    }
                    else {
                        for (i = 0; i < datarows.length && currentrow.length > 0; ++i) {
                            if (datarows[i] == '') break;
                            // break each lines into columns
                            datarows[i] = datarows[i].split(""\\t"");
                            var row = null;
                            var rowId = null;
                            var rowindex = null;
                            for (j = 0; j < datarows[i].length && currentcell.length > 0; ++j) {
                                // mark the row as altered
                                if (!currentcell.parent().hasClass(""altered"")) {
                                    currentcell.parent().addClass(""altered"");
                                    there_are_unsaved_changes = 1;
                                }
                                // for each outer iteration get the rowid
                                if (row == null) {
                                    row = (currentcell).closest('tr.jqgrow');
                                    rowId = row.attr('id');
                                }
                                var icol = fnassetgrid.GetColIndex(currentcell);
                                assetGrid.setCell(rowId, (fnassetgrid.GridColumns())[icol].name, datarows[i][j], '', '', true);
                                prevcell = currentcell;

                                // advance to the next visible cell -- only consider pasting into visible columns
                                do {
                                    currentcell = currentcell.next();
                                }
                                while ((currentcell.length > 0) && currentcell.is("":hidden""))
                            }

                            currentrow = currentrow.next();
                            currentcell = $(currentrow.children(""td"")[firstselectedcolindex]);
                        }
                    }
                }
            }

            if (prevcell.length > 0)
                $(""#hidModEndCell"").val(fnassetgrid.GetRowIndex(prevcell) + "","" + fnassetgrid.GetColIndex(prevcell));
        }

    </script>

Many Thanks in advance!";;replaced http://stackoverflow.com/ with https://stackoverflow.com/
